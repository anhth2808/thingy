extends ../layouts/admin-layout.pug

include ../_includes/sharedHTMLfunctions.pug

block styles
  script(src="https://cdn.ckeditor.com/4.14.0/standard/ckeditor.js")
  link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css')
  script(src='https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js')
  style.
    * { margin: 0; padding: 0; box-sizing: border-box; }
block content
  - var collectionId = null
  each round in room.rounds
    - if (round.isCurrentRound === true) {                  
        - collectionId = round.collectionId._id;                  
    - }
  input(type="hidden", value=user._id, class="user-id")
  input(type="hidden", value=room._id, class="room-id")
  .section.section-tabs
    .container
      .title
        .row
          .col-7          
            h3.mb-3 Danh sách câu hỏi
            select.collection-select.selectpicker(data-live-search='true')
              each collection in collections
                - if (collection._id.equals(collectionId)) {
                  option(data-content=collection.title, selected=true) #{collection._id}
                - } else {
                  option(data-content=collection.title) #{collection._id}
                - }
            // Button trigger modal
            button.btn.btn-info.d-block(type='button', data-toggle='modal', data-target='#exampleModal', title="Thêm câu hỏi vào bộ câu hỏi")
              | Thêm câu hỏi
          .col-5
            .room-actions
              h3.mb-3 Thiết lập phòng
              button.btn.btn-danger.btn-simple.btn-round.btn-clear-room Tạo lại
              button.btn.btn-info.btn-simple.btn-round.btn-next-round Vòng tiếp theo
      .row
        .col-7.question-list
          
          .row.collection-container
            each round in room.rounds
              - if (round.isCurrentRound === true) {                  
                  each question in round.collectionId.questions
                    .col-md-12.ml-auto.col-xl-12.mr-auto
                      .card
                        .card-body
                          .tab-content
                            .tab-question
                              p #{question.questionId.title}
                              button.btn.btn-primary.btn-detail(id=question.questionId._id, data-toggle='modal', data-target='#DetailQuestionModal') Chi tiết
                              button.btn.btn-primary.send-question-button(id=question.questionId._id) Gửi câu hỏi
              - }
            
        .col-5
          .card
            .card-header
              ul.nav.nav-tabs.nav-tabs-primary(role='tablist')
                li.nav-item
                  a.nav-link.active(data-toggle='tab', href='#link4', role='tablist')
                    | Đội trả lời
                li.nav-item
                  a.nav-link(data-toggle='tab', href='#link5', role='tablist')
                    | Bảng xếp hạng
            .card-body
              // Tab panes
              .tab-content.tab-space
                #link4.tab-pane.answer-team.active
                  table.table
                    thead
                      tr
                        th(scope="col") #
                        th(scope="col") Đội
                        //- th(scope="col") Ghi điểm
                    tbody                    
                #link5.tab-pane.ranking
                  table.table
                    thead
                      tr
                        th(scope="col") #
                        th(scope="col") Đội
                        th(scope="col") Điểm
                    tbody
                      each connection in room.connections                      
                        tr
                          th(scope="row") *
                          td #{connection.user.email}
                          td #{connection.score}  
  #RoomTitleModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='RoomTitleModal', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form(action="/admin/room/" + room._id + "/changeTitle", method="post")
          input(type="hidden", name="isUpdateQuestion", value="1")
          .modal-header
            h5#RoomTitleModal.modal-title Nhập tên phòng
            //- button.close(type='button', data-dismiss='modal', aria-label='Close')
            //-   span(aria-hidden='true') ×
          .modal-body          
            .row
              .col-md-12
                .form-group
                  label Tên phòng
                  input.form-control(type='text', class="text-dark", name="roomTitle")
          .modal-footer
            //- button.btn.btn-secondary(type='button', data-dismiss='modal') Close
            button.btn.btn-primary.btn-new-title(type='submit') Xác nhận
  // Modal
  #exampleModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        form(action="/admin/collection/" + collectionId, method="post")
          input(type="hidden", name="isUpdateQuestion", value="1")
          .modal-header
            h5#exampleModalLabel.modal-title Tạo câu hỏi
            button.close(type='button', data-dismiss='modal', aria-label='Close')
              span(aria-hidden='true') ×
          .modal-body          
            .row
              .col-md-12
                .form-group
                  label Tựa đề
                  input.form-control(type='text', class="text-dark", name="title")
            .row
              .col-md-12
                .form-group
                  label Nội Dung
                  textarea#description.form-control(type='text', class="text-dark", name="description")
            .row
              .col-md-12
                .form-group
                  label Số điểm
                  input.form-control(type='number', class="text-dark", name="score")
            .row
              .col-md-12
                .form-group
                  label Đáp án
                  input.form-control(type='text', class="text-dark", name="answer")
          .modal-footer
            button.btn.btn-secondary(type='button', data-dismiss='modal') Close
            button.btn.btn-primary(type='submit') Tạo
  
  #DetailQuestionModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='DetailQuestionModal', aria-hidden='true')
      .modal-dialog(role='document')
        .modal-content
          form(action="/admin/collection/" + collectionId, method="post")
            input(type="hidden", name="isUpdateQuestion", value="1")
            .modal-header
              h5#DetailQuestionModal.modal-title Chi tiết
              button.close(type='button', data-dismiss='modal', aria-label='Close')
                span(aria-hidden='true') ×
            .modal-body          
              .row
                .col-md-12
                  .form-group
                    label Tựa đề
                    input.form-control.detail-title(type='text', class="text-dark", name="title")
              .row
                .col-md-12
                  .form-group
                    label Nội Dung
                    .detail-description                      
              .row
                .col-md-12
                  .form-group
                    label Số điểm
                    input.form-control.detail-score(type='number', class="text-dark", name="score")
              .row
                .col-md-12
                  .form-group
                    label Đáp án
                    input.form-control.detail-answer(type='text', class="text-dark", name="answer")
            .modal-footer
              button.btn.btn-secondary(type='button', data-dismiss='modal') Close
              //- button.btn.btn-primary(type='submit') Tạo
block scripts
  script.
    window.onload = function() {
       $(function(){app.admin()});
    }
  script.
    CKEDITOR.replace( 'description' )